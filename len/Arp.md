# ARP实操

## 前言

**严正声明：本文仅限于技术讨论与分享，严禁用于非法途径。**

| 工具       | 简介                                   |
| -------- | ------------------------------------ |
| arpspoof | ARP欺骗的工具，可毒化受害者ARP缓存，将网关MAC替换为攻击者MAC |
| driftnet | 图片捕获工具，用于监听网络流量并从它观察到的TCP流中提取图像的程序   |
| ettercap | 网络抓包工具，利用ARP协议的缺陷进行中间人攻击，嗅探局域网数据流量   |

## 环境

| 主机          | IP地址          |
| ----------- | ------------- |
| Kali Linux  | 192.168.0.198 |
| Win 10 物理机  | 192.168.0.106 |
| honor 20 手机 | 192.168.0.105 |
| 魅族 A5 手机    | 192.168.0.100 |

Kali 虚拟机使用桥接模式，Win 10 物理机和 华为荣耀20、魅族A5 实体手机连接同一个WIFI，使得四者处于同一局域网同一网段之下，可互相(Ping)连通。

## 断网

在演示如何对局域网内部的主机进行断网攻击之前，我们先来了解下攻击原理——ARP欺骗。

### ARP欺骗

**1、ARP协议**

ARP(Address Resolution Protocol)即地址解析协议，是根据IP地址获取物理地址的一个TCP/IP协议。主机发送信息时将包含目标IP地址的ARP请求广播到局域网络上的所有主机，并接收返回消息，以此确定目标的物理地址；收到返回消息后将该IP地址和物理地址存入本机ARP缓存中并保留一定时间，下次请求时直接查询ARP缓存以节约资源。

**2、ARP欺骗**

地址解析协议是建立在网络中各个主机互相信任的基础上的，局域网络上的主机可以自主发送ARP应答消息，其他主机收到应答报文时不会检测该报文的真实性就会将其记入本机ARP缓存；由此攻击者就可以向某一主机发送伪ARP应答报文，使其发送的信息无法到达预期的主机或到达错误的主机，这就构成了一个ARP欺骗。

由于ARP缓存表不是实时更新的，如果在网络中产生大量的ARP通信量，攻击者只要持续不断的发出伪造的ARP响应包就能更改目标主机ARP缓存中的IP-MAC条目，造成网络中断或中间人攻击。

下面的演示实验将使用网关型欺骗的ARP欺骗攻击，通过欺骗受害PC主机/手机，将局域网的网关地址设置为Kali主机的IP地址， 使目标主机认为攻击者的网卡是网关，从而将数据包都发给攻击者的网卡，如果攻击者直接将数据包丢弃（不开启转发），即是断网攻击。如果攻击者的网卡再开启转发，将数据包传到真正网关，则可实现受害主机不断网。

### 攻击演示

1、将 Kali 虚拟机配置为桥接模式，查看其IP地址和网关地址

![在这里插入图片描述](https://i-blog.csdnimg.cn/blog_migrate/7aad7db251558f1e63d5b27a857b161a.png)

2、使用Nmap扫描局域网中存活的主机的信息（也可以使用 Kali 内置的 Nmap 图形化界面软件 Zenmap 扫描，结果是一样的）

![在这里插入图片描述](https://i-blog.csdnimg.cn/blog_migrate/9d2230c15f649eb837374fefec7f899c.png)



3、在Kali终端执行 `arpspoof` 命令：`arpspoof -i en0 -t 192.168.0.106(目标IP) 192.168.0.1(网关IP)`，开始进行 ARP 断网攻击，攻击目标为 Win 10 物理主机

![在这里插入图片描述](https://i-blog.csdnimg.cn/blog_migrate/6ec9dca1dd8234fe5dbc673084a33041.png)

4、此时 Win 10 主机已经无法正常连接互联网，访问百度后如下

![在这里插入图片描述](https://i-blog.csdnimg.cn/blog_migrate/5412298fc00bb3788da9ec5bc88c3013.png)

5、在 Kali 的终端中按下键盘 `Ctrl+Z` 组合键中断欺骗，物理机就可以恢复正常访问互联网了



## 图片窃取

你以为Kali能做的仅仅是让局域网中主机断网这么简单？单纯截断受害者的数据流量可没多大意思，我们何不自己充当中间人将其数据流量转发出去，然后~~监听、获取受害者的数据流量呢~~

### 端口转发

在对受害者实施以上ARP欺骗实现断网攻击后，如果攻击者将自己的网卡开启流量转发，将截获的数据包传到真正网关，则可让受害主机不断网，同时可以监听到受害者主机的数据流量的内容。

1、编辑 Kali Linux 虚拟机 `/etc/sysctl.conf` 配置文件，将`net.ipv4.ip_forward`配置项取消掉“#”注释符号，并将其值由 0 改为 1 即可开启端口转发

![在这里插入图片描述](https://i-blog.csdnimg.cn/blog_migrate/2cb4e9adb854ca765804c3adf72a2e24.png)

2、接着在 Kali 终端重新执行 `arpspoof` 命令（注意网关IP和主机IP顺序此时需要对换一下）：`arpspoof -i en0 -t 192.168.0.1(网关IP) 192.168.0.106(目标IP)`，重新对 Win 10 主机发动 ARP 欺骗攻击，此时其仍能正常联网，端口转发成功

![在这里插入图片描述](https://i-blog.csdnimg.cn/blog_migrate/343bdc682e8aa722d791f523e1ea3b0f.png)

### 演示

`driftnet`是一款简单而使用的图片捕获工具，可以很方便的在网络数据包中抓取图片，其使用语法： `driftnet [options] [filter code]`。

| 选项  | 描述                          |
| --- | --------------------------- |
| -b  | 捕获到新的图片时发出嘟嘟声               |
| -i  | interface 选择监听接口            |
| -f  | file 读取一个指定pcap数据包中的图片      |
| -p  | 不让所监听的接口使用混杂模式              |
| -a  | 后台模式：将捕获的图片保存到目录中（不会显示在屏幕上） |
| -m  | number 指定保存图片数的数目           |
| -d  | directory 指定保存图片的路径         |
| -x  | prefix 指定保存图片的前缀名           |

1、此次图片窃取的演示使用IP地址为`192.168.0.105`的华为荣耀20手机(前面断网不成功，本菜表示不服)，首先开启ARP欺骗

![在这里插入图片描述](https://i-blog.csdnimg.cn/blog_migrate/2c41ce7cb3cd157f8d5638888002693d.png)

2、打开另外一个终端并执行 `driftnet -i eth0 -a -d /root/hhh` 命令，该命令会自动将手机浏览的图片保存到Kali虚拟机的`/root/hhh`路径下

![在这里插入图片描述](https://i-blog.csdnimg.cn/blog_migrate/ffa2923f7e841219daec2dc03a2c91b9.png)

3、上图已成功获取到手机上正在访问的图片信息，而此时手机打开的是 “央视新闻” 微信公众号的新闻链接，图中保存了文章评论者的头像

![在这里插入图片描述](https://i-blog.csdnimg.cn/blog_migrate/ebaa37697099a9d71a3590e7e72ed736.png)

4、此处还对 IPhone手机、Win 10物理主机均进行了测试，均可成功监听并保存受害主机的图片

![在这里插入图片描述](https://i-blog.csdnimg.cn/blog_migrate/261f987a7513d3d39419f995814a8ef5.png)

至此，图片监听窃取的攻击演示结束……骚年，看到这里，你还敢连着WIFI肆无忌惮地看“不可描述”的东西么？

## 密码监听-ettercap

`ettercap`是一款网络抓包工具，利用ARP协议的缺陷进行中间人攻击，可嗅探局域网数据流量。

`ettercap` 的参数及常用操作

| 选项  | 描述                                        |
| --- | ----------------------------------------- |
| -l  | 显示可用网卡接口设备                                |
| -i  | 选择接口                                      |
| -t  | 协议选择，tcp/udp/all，默认为all                   |
| -p  | 不进行毒化攻击，用于嗅探本地数据包                         |
| -L  | 载入过滤器文件                                   |
| -V  | text 将数据包以文本形式显示在屏幕上                      |
| -L  | filename 把所有的数据包保存下来（保存后的文件只能用etterlog显示） |

### 演示

1、同样先在Kali终端执行 `arpspoof` 命令开启 ARP 欺骗攻击，攻击目标为 Win 10 物理主机

![在这里插入图片描述](https://i-blog.csdnimg.cn/blog_migrate/df0264e9fb2f895fc285603ce83510f5.png)

2、然后在物理机上打开一个合天网安实验室官网的登陆页面


![在这里插入图片描述](https://i-blog.csdnimg.cn/blog_migrate/1c4e5ccd906fecc8bf64d2cd350c40ca.png)3、打开另一个 Kali 终端，开始利用 `ettercap` 来抓取账号密码，在终端输入命令`ettercap -Tq -i eth0`（这条命令表示监控 eth0 网卡的流量）即可，监听状态如下图

![在这里插入图片描述](https://i-blog.csdnimg.cn/blog_migrate/92f0e1fdda269de9b0cc0732d96e4b1d.png)

4、此时在物理机输入正确的账号和密码后，即可在虚拟机终端输出打印其账号密码等登录信息

![在这里插入图片描述](https://i-blog.csdnimg.cn/blog_migrate/afe9123d19ade9911f89366861b85efb.png)



# 内容来源

版权声明：本文为博主原创文章，遵循 CC 4.0 BY-SA 版权协议，转载请附上原文出处链接和本声明。

原文链接：https://blog.csdn.net/weixin_39190897/article/details/104569308